!function(a){function _(e){return e&&("onepage.php"===e||0===e.indexOf("onepager-")||0===e.indexOf("onepager/"))}function v(e,t){var n=prompt(wp.i18n.__("Enter template name","tx-onepager"),wp.i18n.__("mytemplate","tx-onepager")),o={action:"onepager_get_sections",pageId:e},i="onepager-"+t+"-"+e+"-"+Date.now(),p=(t=t||"template-"+e)+".jpg";a.post(ajaxurl,o,function(e){var t,o,a;e.success?(t={name:n,screenshot:p,file:i,identifier:"txonepager",type:"page",sections:e.sections},o="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),(a=document.getElementById("downloadAnchorElem")).setAttribute("href",o),a.setAttribute("download",t.file+".json"),a.click()):alert(wp.i18n.__("oops!! onepager could not export this page","tx-onepager"))})}function b(){var e={action:"onepager_get_sections",pageId:onepager.pageId},o={action:"onepager_save_sections",updated:null,pageId:onepager.pageId,sections:[]};a.post(ajaxurl,e,function(e){if(e&&e.success&&0!==e.sections.length){var t=wp.i18n.__("Are you sure you want to insert this layout?","tx-onepager")+wp.i18n.__("This layout will replace your current layout!","tx-onepager");if(!confirm(t))return;m(o)}else m(o)})}function m(e){a(".onepager-loading").css("display","block"),a.post(ajaxurl,e,function(e){e&&e.success?(location.href=onepager.buildModeUrl,a(".onepager-loading").css("display","none")):(a(".onepager-loading").css("display","none"),alert(wp.i18n.__("failed to insert layout ","tx-onepager")))})}a(function(a){var n=onepager.pageId,e=wp.i18n.__("Enable Onepager","tx-onepager"),t=wp.i18n.__("Disable Onepager","tx-onepager"),i=a('<button type="button" id="enable-onepager" class="op-btn op-btn-with-logo">'+e+"</button>"),p=a('<button type="button" id="disable-onepager" class="op-btn op-btn-with-logo">'+t+"</button>"),r=a('<div class="onepager-loading" style="display:none"><div uk-spinner></div></div>'),o=a(".op-select-preset"),l=a("#postdivrich"),s=a("#page_template"),c=a("#onepager-export-layout"),d=a("#onepager_meta"),g=a("#blank-template"),u=a("#op-group-filter select"),h=a("#op-presets>.media"),w=a("#publish");function f(){s.length||setTimeout(function(){a("#post-title-0").focus()},500)}window.exportSections=function(e,t){v(t=t||n,e)},u.on("change",function(){var e=a(this).val();h.hide(),a(e).show()}),c.on("click",function(e){v(n,"template"),e.preventDefault()}),s.on("change",function(){var e=a(this).val();setTimeout(function(){_(e)?(l.hide(),i.hide(),p.show(),d.show()):(l.show(),i.show(),p.hide(),d.hide())},10)}),s.trigger("change"),o.on("click",function(){{var e;s.length?(e=a("#title")).val()||(e.val("OnePager #"+a("#post_ID").val()),a("#title-prompt-text").addClass("screen-reader-text")):wp.data.select("core/editor").getEditedPostAttribute("title")||wp.data.dispatch("core/editor").editPost({title:"OnePager #"+a("#post_ID").val()})}var t=wp.i18n.__("Are you sure you want to insert this layout?","tx-onepager")+wp.i18n.__("This layout will replace your current layout!","tx-onepager"),o=a(this).attr("data-layout-id");confirm(t)&&(a(".onepager-loading").css("display","block"),function(e,t){m({action:"onepager_select_layout",layoutId:t,pageId:e})}(n,o))}),g.on("click",b),i.on("click",function(){var e=a("#title");e.val()||(e.val("OnePager #"+a("#post_ID").val()),a("#title-prompt-text").addClass("screen-reader-text"));{s.length?(s.find('option[value="onepager/onepage.php"]').get(0)?s.val("onepager/onepage.php"):s.val("onepage.php"),s.trigger("change"),w.click()):(a(".onepager-loading").show(),wp.data.select("core/editor").getEditedPostAttribute("title")||wp.data.dispatch("core/editor").editPost({title:"OnePager #"+a("#post_ID").val()}),wp.data.dispatch("core/editor").editPost({template:"onepage.php"}),a(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").hide(),wp.data.dispatch("core/editor").savePost(),function e(){setTimeout(function(){wp.data.select("core/editor").isSavingPost()?e():(r.hide(),i.hide(),p.show(),d.show(),f())},300)}())}}),p.on("click",function(){r.show(),s.length?(s.val("default"),s.trigger("change"),w.click()):(wp.data.dispatch("core/editor").editPost({template:""}),a(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").show(),wp.data.dispatch("core/editor").savePost(),function e(){setTimeout(function(){wp.data.select("core/editor").isSavingPost()?e():(r.hide(),i.show(),p.hide(),d.hide())},300)}())}),function o(){setTimeout(function(){var e,t;a("#wpadminbar").length?(l.length?(l.before(i),l.before(p)):($gutenberg=a("#editor"),$gutenberg.find(".edit-post-header-toolbar").append(p),$gutenberg.find(".edit-post-header-toolbar").append(i)),a(".block-editor")&&a(".block-editor").prepend(r),e=a("#page_template"),t=a(".editor-page-attributes__template select"),console.log(e.val()),console.log(t.val()),"onepage.php"==e.val()||"onepager-default.php"==e.val()||"onepage.php"==t.val()||"onepager-default.php"==t.val()?(i.hide(),p.show(),d.show(),a(".editor-block-list__layout, .wp-block.editor-writing-flow__click-redirect").hide(),a("#onepager_meta").removeClass("closed"),a("#onepager_meta .op-editpage-link").show()):(i.show(),p.hide())):o()},1e3)}()})}(jQuery);