!function(s){var l=null;s.modal=function(t,o){var e,i;if(s.modal.close(),this.$body=s("body"),this.options=s.extend({},s.modal.defaults,o),this.options.doFade=!isNaN(parseInt(this.options.fadeDuration,10)),t.is("a"))if(i=t.attr("href"),/^#/.test(i)){if(this.$elm=s(i),1!==this.$elm.length)return null;this.open()}else this.$elm=s("<div>"),this.$body.append(this.$elm),e=function(o,t){t.elm.remove()},this.showSpinner(),t.trigger(s.modal.AJAX_SEND),s.get(i).done(function(o){l&&(t.trigger(s.modal.AJAX_SUCCESS),l.$elm.empty().append(o).on(s.modal.CLOSE,e),l.hideSpinner(),l.open(),t.trigger(s.modal.AJAX_COMPLETE))}).fail(function(){t.trigger(s.modal.AJAX_FAIL),l.hideSpinner(),t.trigger(s.modal.AJAX_COMPLETE)});else this.$elm=t,this.$body.append(this.$elm),this.open()},s.modal.prototype={constructor:s.modal,open:function(){var o=this;this.options.doFade?(this.block(),setTimeout(function(){o.show()},this.options.fadeDuration*this.options.fadeDelay)):(this.block(),this.show()),this.options.escapeClose&&s(document).on("keydown.modal",function(o){27==o.which&&s.modal.close()}),this.options.clickClose&&this.blocker.click(s.modal.close)},close:function(){this.unblock(),this.hide(),s(document).off("keydown.modal")},block:function(){var o=this.options.doFade?0:this.options.opacity;this.$elm.trigger(s.modal.BEFORE_BLOCK,[this._ctx()]),this.blocker=s('<div class="jquery-modal blocker"></div>').css({top:0,right:0,bottom:0,left:0,width:"100%",height:"100%",position:"fixed",zIndex:this.options.zIndex,background:this.options.overlay,opacity:o}),this.$body.append(this.blocker),this.options.doFade&&this.blocker.animate({opacity:this.options.opacity},this.options.fadeDuration),this.$elm.trigger(s.modal.BLOCK,[this._ctx()])},unblock:function(){this.options.doFade?this.blocker.fadeOut(this.options.fadeDuration,function(){s(this).remove()}):this.blocker.remove()},show:function(){this.$elm.trigger(s.modal.BEFORE_OPEN,[this._ctx()]),this.options.showClose&&(this.closeButton=s('<a href="#close-modal" rel="modal:close" class="close-modal '+this.options.closeClass+'">'+this.options.closeText+"</a>"),this.$elm.append(this.closeButton)),this.$elm.addClass(this.options.modalClass+" current"),this.center(),this.options.doFade?this.$elm.fadeIn(this.options.fadeDuration):this.$elm.show(),this.$elm.trigger(s.modal.OPEN,[this._ctx()])},hide:function(){this.$elm.trigger(s.modal.BEFORE_CLOSE,[this._ctx()]),this.closeButton&&this.closeButton.remove(),this.$elm.removeClass("current");var o=this;this.options.doFade?this.$elm.fadeOut(this.options.fadeDuration,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}):this.$elm.hide(0,function(){o.$elm.trigger(s.modal.AFTER_CLOSE,[o._ctx()])}),this.$elm.trigger(s.modal.CLOSE,[this._ctx()])},showSpinner:function(){this.options.showSpinner&&(this.spinner=this.spinner||s('<div class="'+this.options.modalClass+'-spinner"></div>').append(this.options.spinnerHtml),this.$body.append(this.spinner),this.spinner.show())},hideSpinner:function(){this.spinner&&this.spinner.remove()},center:function(){this.$elm.css({position:"fixed",top:"50%",left:"50%",marginTop:-this.$elm.outerHeight()/2,marginLeft:-this.$elm.outerWidth()/2,zIndex:this.options.zIndex+1})},_ctx:function(){return{elm:this.$elm,blocker:this.blocker,options:this.options}}},s.modal.prototype.resize=s.modal.prototype.center,s.modal.close=function(o){if(l){o&&o.preventDefault(),l.close();var t=l.$elm;return l=null,t}},s.modal.resize=function(){l&&l.resize()},s.modal.isActive=function(){return!!l},s.modal.defaults={overlay:"#000",opacity:.75,zIndex:1,escapeClose:!0,clickClose:!0,closeText:"Close",closeClass:"",modalClass:"modal",spinnerHtml:null,showSpinner:!0,showClose:!0,fadeDuration:null,fadeDelay:1},s.modal.BEFORE_BLOCK="modal:before-block",s.modal.BLOCK="modal:block",s.modal.BEFORE_OPEN="modal:before-open",s.modal.OPEN="modal:open",s.modal.BEFORE_CLOSE="modal:before-close",s.modal.CLOSE="modal:close",s.modal.AFTER_CLOSE="modal:after-close",s.modal.AJAX_SEND="modal:ajax:send",s.modal.AJAX_SUCCESS="modal:ajax:success",s.modal.AJAX_FAIL="modal:ajax:fail",s.modal.AJAX_COMPLETE="modal:ajax:complete",s.fn.modal=function(o){return 1===this.length&&(l=new s.modal(this,o)),this},s(document).on("click.modal",'a[rel="modal:close"]',s.modal.close),s(document).on("click.modal",'a[rel="modal:open"]',function(o){o.preventDefault(),s(this).modal()})}(jQuery);